// Generated by Haxe 3.4.2
package hxDaedalus.data.math;

public class Tools extends haxe.lang.HxObject
{
	public Tools(haxe.lang.EmptyObject empty)
	{
	}
	
	
	public Tools()
	{
		hxDaedalus.data.math.Tools.__hx_ctor_hxDaedalus_data_math_Tools(this);
	}
	
	
	public static void __hx_ctor_hxDaedalus_data_math_Tools(hxDaedalus.data.math.Tools __hx_this)
	{
	}
	
	
//	public static hxDaedalus.data.Mesh extractMeshFromBitmap(hxPixels._Pixels.PixelsData pixels, haxe.root.Array<hxDaedalus.data.math.Point2D> vertices, haxe.root.Array<java.lang.Object> triangles)
//	{
//		//line 19 "/Users/tao/projects/hxDaedalus/src/hxDaedalus/data/math/Tools.hx"
//		haxe.root.Array<haxe.root.Array<java.lang.Object>> shapes = hxDaedalus.data.math.Potrace.buildShapes(pixels, null, null);
//		//line 21 "/Users/tao/projects/hxDaedalus/src/hxDaedalus/data/math/Tools.hx"
//		return hxDaedalus.data.math.Tools.extractMeshFromShapes(shapes, pixels.width, pixels.height, vertices, triangles, null);
//	}
	
	
	public static hxDaedalus.data.Mesh extractMeshFromShapes(haxe.root.Array<haxe.root.Array<java.lang.Object>> shapes, int width, int height, haxe.root.Array<hxDaedalus.data.math.Point2D> vertices, haxe.root.Array<java.lang.Object> triangles, java.lang.Object invertWinding)
	{
		boolean __temp_invertWinding21 = ( (haxe.lang.Runtime.eq(invertWinding, null)) ? (false) : (haxe.lang.Runtime.toBool(invertWinding)) );
		haxe.root.Array<hxDaedalus.data.graph.Graph> graphs = new haxe.root.Array<hxDaedalus.data.graph.Graph>();
		{
			int _g1 = 0;
			int _g = shapes.length;
			while (( _g1 < _g ))
			{
				int i = _g1++;
				graphs.push(hxDaedalus.data.math.Potrace.buildGraph(shapes.__get(i)));
			}
			
		}
		
		haxe.root.Array<haxe.root.Array<java.lang.Object>> polygons = new haxe.root.Array<haxe.root.Array<java.lang.Object>>();
		{
			int _g11 = 0;
			int _g2 = graphs.length;
			while (( _g11 < _g2 ))
			{
				int i1 = _g11++;
				polygons.push(hxDaedalus.data.math.Potrace.buildPolygon(graphs.__get(i1), null));
			}
			
		}
		
		hxDaedalus.data.Mesh mesh = hxDaedalus.factories.RectMesh.buildRectangle(width, height);
		haxe.root.Array<hxDaedalus.data.Edge> edges = new haxe.root.Array<hxDaedalus.data.Edge>();
		hxDaedalus.data.ConstraintSegment segment;
		{
			int _g12 = 0;
			int _g3 = polygons.length;
			while (( _g12 < _g3 ))
			{
				int i2 = _g12++;
				int j = 0;
				while (( j < ( polygons.__get(i2).length - 2 ) ))
				{
					segment = mesh.insertConstraintSegment(haxe.lang.Runtime.toDouble(polygons.__get(i2).__get(j)), haxe.lang.Runtime.toDouble(polygons.__get(i2).__get(( j + 1 ))), haxe.lang.Runtime.toDouble(polygons.__get(i2).__get(( j + 2 ))), haxe.lang.Runtime.toDouble(polygons.__get(i2).__get(( j + 3 ))));
					if (( j == 0 )) 
					{
						if (( ( segment.get_edges().__get(0).get_originVertex().get_pos().x == haxe.lang.Runtime.toDouble(polygons.__get(i2).__get(j))) && ( segment.get_edges().__get(0).get_originVertex().get_pos().y == haxe.lang.Runtime.toDouble(polygons.__get(i2).__get(( j + 1 )))) ))
						{
							if ( ! (__temp_invertWinding21) ) 
							{
								edges.push(segment.get_edges().__get(0));
							}
							else
							{
								edges.push(segment.get_edges().__get(0).get_oppositeEdge());
							}
							
						}
						else
						{
							if ( ! (__temp_invertWinding21) ) 
							{
								edges.push(segment.get_edges().__get(0).get_oppositeEdge());
							}
							else
							{
								edges.push(segment.get_edges().__get(0));
							}
							
						}
						
					}
					
					j += 2;
				}
				
				mesh.insertConstraintSegment(haxe.lang.Runtime.toDouble(polygons.__get(i2).__get(0)), haxe.lang.Runtime.toDouble(polygons.__get(i2).__get(1)), haxe.lang.Runtime.toDouble(polygons.__get(i2).__get(j)), haxe.lang.Runtime.toDouble(polygons.__get(i2).__get(( j + 1 ))));
			}
			
		}
		
		haxe.ds.ObjectMap<hxDaedalus.data.Vertex, java.lang.Object> indicesDict = new haxe.ds.ObjectMap<hxDaedalus.data.Vertex, java.lang.Object>();
		hxDaedalus.data.Vertex vertex;
		hxDaedalus.data.math.Point2D point;
		{
			int _g13 = 0;
			int _g4 = mesh._vertices.length;
			while (( _g13 < _g4 ))
			{
				int i3 = _g13++;
				vertex = mesh._vertices.__get(i3);
				if (( ( ( ( vertex.get_isReal() && ( vertex.get_pos().x > 0 ) ) && ( vertex.get_pos().x < width ) ) && ( vertex.get_pos().y > 0 ) ) && ( vertex.get_pos().y < height ) )) 
				{
					point = new hxDaedalus.data.math.Point2D(vertex.get_pos().x, vertex.get_pos().y);
					vertices.push(point);
					{
						int v = ( vertices.length - 1 );
						indicesDict.set(vertex, v);
					}
					
				}
				
			}
			
		}
		
		haxe.ds.ObjectMap<hxDaedalus.data.Face, java.lang.Object> facesDone = new haxe.ds.ObjectMap<hxDaedalus.data.Face, java.lang.Object>();
		haxe.root.Array<hxDaedalus.data.Face> openFacesList = new haxe.root.Array<hxDaedalus.data.Face>();
		{
			int _g14 = 0;
			int _g5 = edges.length;
			while (( _g14 < _g5 ))
			{
				int i4 = _g14++;
				openFacesList.push(edges.__get(i4).get_rightFace());
			}
			
		}
		
		hxDaedalus.data.Face currFace;
		while (( openFacesList.length > 0 ))
		{
			currFace = ((hxDaedalus.data.Face) (openFacesList.pop()) );
			if (haxe.lang.Runtime.toBool(facesDone.get(currFace)))
			{
				continue;
			}
			
			triangles.push(indicesDict.get(currFace.get_edge().get_originVertex()));
			triangles.push(indicesDict.get(currFace.get_edge().get_nextLeftEdge().get_originVertex()));
			triangles.push(indicesDict.get(currFace.get_edge().get_nextLeftEdge().get_destinationVertex()));
			if ( ! (currFace.get_edge().get_isConstrained()) ) 
			{
				openFacesList.push(currFace.get_edge().get_rightFace());
			}
			
			if ( ! (currFace.get_edge().get_nextLeftEdge().get_isConstrained()) ) 
			{
				openFacesList.push(currFace.get_edge().get_nextLeftEdge().get_rightFace());
			}
			
			if ( ! (currFace.get_edge().get_prevLeftEdge().get_isConstrained()) ) 
			{
				openFacesList.push(currFace.get_edge().get_prevLeftEdge().get_rightFace());
			}
			
			facesDone.set(currFace, true);
		}
		
		return mesh;
	}
	
	
}


